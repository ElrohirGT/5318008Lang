class Color {
  let r: integer;
  let g: integer;
  let b: integer;

  function WithR(r: integer): Color {
      this.r = r;
      return this;
  }

  function WithG(g: integer): Color {
    this.g = g;
    return this;
  }

  function WithB(b: integer): Color {
    this.b = b;
    return this;
  }

  function ToArray(buffer: integer[]) {
    buffer[0] = this.r;
    buffer[1] = this.g;
    buffer[2] = this.b;
  }
}

let color = new Color();
let buffer = [0,0,0];
color
  .WithR(100)
  .WithG(100)
  .WithB(100)
  .ToArray(buffer);
---
ALLOC t25 12
// this
PARAM t25
// newColor()
CALL Color_constructor 1
ALLOC t26 12
SWO t26 0 0
SWO t26 4 0
SWO t26 8 0
// this -> color
PARAM t25
PARAM 100
// color.WithR(100)
CALLRET t27 Color_WithR 2
// this -> color.WithR(100)
PARAM t27
PARAM 100
// color.WithR(100).WithG(100)
CALLRET t28 Color_WithG 2
// this -> color.WithR(100).WithG(100)
PARAM t28
PARAM 100
// color.WithR(100).WithG(100).WithB(100)
CALLRET t29 Color_WithB 2
// this -> color.WithR(100).WithG(100).WithB(100)
PARAM t29
// buffer
PARAM t26
// color.WithR(100).WithG(100).WithB(100).ToArray(buffer)
CALL Color_ToArray 2
END

FUNC Color_ToArray:
	// this
	LOAD t17
	// buffer
	LOAD t18
	LWO t19 t17 0
	ADD t20 0 0
	ADD t20 t20 0
	SWO t18 t20 t19
	LWO t21 t17 4
	ADD t22 0 0
	ADD t22 t22 4
	SWO t18 t22 t21
	LWO t23 t17 8
	ADD t24 0 0
	ADD t24 t24 8
	SWO t18 t24 t23
	END
FUNC Color_WithB:
	// this
	LOAD t14
	// b
	LOAD t15
	= t16 i32 8
	SWO t14 t16 t15
	RETURN t14
	END
FUNC Color_WithG:
	// this
	LOAD t11
	// g
	LOAD t12
	= t13 i32 4
	SWO t11 t13 t12
	RETURN t11
	END
FUNC Color_WithR:
	// this
	LOAD t8
	// r
	LOAD t9
	= t10 i32 0
	SWO t8 t10 t9
	RETURN t8
	END
FUNC Color_constructor:
	// this
	LOAD t1
	ADD t2 0 0
	= t3 i32 0
	ADD t4 0 4
	= t5 i32 0
	ADD t6 0 8
	= t7 i32 0
	END