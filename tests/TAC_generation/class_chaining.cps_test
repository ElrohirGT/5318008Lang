class Color {
  let r: integer;
  let g: integer;
  let b: integer;

  function WithR(r: integer): Color {
      this.r = r;
      return this;
  }

  function WithG(g: integer): Color {
    this.g = g;
    return this;
  }

  function WithB(b: integer): Color {
    this.b = b;
    return this;
  }

  function ToArray(buffer: integer[]) {
    buffer[0] = this.r;
    buffer[1] = this.g;
    buffer[2] = this.b;
  }
}

let color = new Color();
let buffer = [0,0,0];
color
  .WithR(100)
  .WithG(100)
  .WithB(100)
  .ToArray(buffer);
---
ALLOC t22 12
// this
PARAM t22
// newColor()
CALL Color_constructor 1
ALLOC t23 12
SWO t23 0 0
SWO t23 4 0
SWO t23 8 0
// this -> color
PARAM t22
PARAM 100
// color.WithR(100)
CALLRET t24 Color_WithR 2
// this -> color.WithR(100)
PARAM t24
PARAM 100
// color.WithR(100).WithG(100)
CALLRET t25 Color_WithG 2
// this -> color.WithR(100).WithG(100)
PARAM t25
PARAM 100
// color.WithR(100).WithG(100).WithB(100)
CALLRET t26 Color_WithB 2
// this -> color.WithR(100).WithG(100).WithB(100)
PARAM t26
// buffer
PARAM t23
// color.WithR(100).WithG(100).WithB(100).ToArray(buffer)
CALL Color_ToArray 2
END

FUNC Color_ToArray:
	// this
	LOAD t14
	// buffer
	LOAD t15
	LWO t16 t14 0
	ADD t17 0 0
	ADD t17 t17 0
	SWO t15 t17 t16
	LWO t18 t14 4
	ADD t19 0 0
	ADD t19 t19 4
	SWO t15 t19 t18
	LWO t20 t14 8
	ADD t21 0 0
	ADD t21 t21 8
	SWO t15 t21 t20
	END
FUNC Color_WithB:
	// this
	LOAD t11
	// b
	LOAD t12
	= t13 i32 8
	SWO t11 t13 t12
	RETURN t11
	END
FUNC Color_WithG:
	// this
	LOAD t8
	// g
	LOAD t9
	= t10 i32 4
	SWO t8 t10 t9
	RETURN t8
	END
FUNC Color_WithR:
	// this
	LOAD t5
	// r
	LOAD t6
	= t7 i32 0
	SWO t5 t7 t6
	RETURN t5
	END
FUNC Color_constructor:
	// this
	LOAD t1
	ADD t2 0 0
	SWO t1 t2 0
	ADD t3 0 4
	SWO t1 t3 0
	ADD t4 0 8
	SWO t1 t4 0
	END